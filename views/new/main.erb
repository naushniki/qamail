<!DOCTYPE html>
<html ng-app="QaMail">
  <link rel="icon" type="image/png" href="/favicon.png" />
  <script src="/js/lib/angular.min.js"></script>
  <script src="/js/lib/xml2json.min.js"></script>
  <script src="/js/lib/jquery.min.js"></script>
  <script src="/js/app.js"></script>
  <link rel="stylesheet" href="/css/lib/pure/pure-min.css">
  <link rel="stylesheet" href="/css/lib/pure/grids-responsive-min.css">
  <link rel="stylesheet" href="/css/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/qamail.css">
  <title>QA Mail</title>
  <body ng-controller="mailboxController">
  <style>
  .main-grid {
    z-index: 5;
  }
  .current_mailbox_content{
    overflow-y: scroll;
    max-height: 100%;
    height: 100%;
  }
  </style>
    <div class="header">
        <style scoped>
            .button-xlarge {
                font-size: 125%;
            }
            .input-xlarge {
                font-size: 125%;
            }
            .button-delete {
                color: white;
                border-radius: 4px;
                text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
                background: rgb(223, 117, 20); /* this is an orange */
            }
            .button-refresh {
                color: white;
                border-radius: 4px;
                text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
                background: rgb(66, 184, 221); /* this is a light blue */
            }
            .home-menu{
              z-index: 10;
              background: white;
            }
    
        </style>
        <div class="home-menu pure-menu pure-menu-horizontal pure-menu-fixed" id="top-menu">
            <table width="100%">
                <tr>
                    <td align="left">
                    <form class="pure-form pure-form-aligned">
                    <select id="current_mailbox" class="pure-input input-xlarge" ng-model="currentMailbox" ng-options="mailbox.address for mailbox in sessionMailboxes" ng-change="getLetters();">
                    </select>
                      <button class="button-refresh pure-button button-xlarge" ng-click="goToPreviousMailbox();"><i class="fa fa-arrow-left"></i></button>
                      <button class="button-refresh pure-button button-xlarge" ng-click="goToNextMailbox();"><i class="fa fa-arrow-right"></i></button>
                    </td>
                    <td><center><h1>{{ currentMailbox.address }}</h1></center></td>
                    <td align="right">
                    <li class="pure-menu-item pure-menu-selected">
                    <button class="pure-button pure-button-primary button-xlarge" ng-click="createMailbox();"><i class="fa fa-plus-square-o"></i>Create new mailbox</button>
                    <button class="button-refresh pure-button button-xlarge" ng-click="getLetters();"><i class="fa fa-refresh"></i>Refresh</button>
                    <button class="button-delete pure-button button-xlarge" ng-click="emptyMailbox();"><i class="fa fa-trash-o"></i>Empty mailbox</button>
                    </li>
                    </td>
                    </form>
                </tr>
            </table>
           
        </div>
      </div>
  
      <div class="pure-g main-grid" id="main-grid">
  
          <div class="pure-u-1-3 current_mailbox_content" id="current_mailbox_content">
            <li ng-repeat="letter in letters">
              <div class = "email-item" onclick="select_letter(this);" ng-click="displayLetter({{letter.id}});">
                <h4 class="email-from">{{ letter.from }}</h4>
                <h4 class="email-subject">{{ letter.subject }}</h4>
                <h4 class="email-date">{{ letter.date }}</h4>
              </div>
            </a>
            </li>

          </div>
          <div class="pure-u-2-3 letter_viewer" id="letter_viewer" display="none">
          <div class="email-content-header pure-g">
            <div class="pure-u-1-2">
              <h1 class="email-content-title">{{currentLetter.subject}}</h1>
              <p class="email-content-subtitle">
                From: {{currentLetter.from}} at {{currentLetter.date}}
              </p>
            </div>
            <div class="email-content-controls pure-u-1-2">
              <button class="secondary-button pure-button">Show raw message</button>
              <button class="secondary-button pure-button">Show HTML</button>
              <button class="secondary-button pure-button">Show plain text</button>
              <button class="secondary-button pure-button">Reply</button>
            </div>
          </div>
          <div class="letter_content"></div>
          <iframe class="letter_content" id="letter_content" src="" frameborder="0" scrolling="no"></iframe>
          </div>
      </div>
      </div>
    </body>

      <div class="footer" id="footer">
          <center><small><a href="https://bitbucket.org/naushniki/qamail">QA Mail on Bitbucket</a></small></center>
      </div>
    <script language="javascript">
    var sessionKey = "<%= @session.session_key %>";
    function align_main_grid(obj) {
      obj.style.marginTop = ($( "#top-menu" ).height() + "px");
      obj.style.marginBottom = (($( "#footer" ).height()) + "px");
    }
    function set_max_height(obj) {
      obj.style.maxHeight = $(window).height() - 20 - $( "#top-menu" ).height() - $( "#footer" ).height() + "px";
      obj.style.height = $(window).height() - 20 - $( "#top-menu" ).height() - $( "#footer" ).height() + "px";
    }
    function align(){
      align_main_grid(document.getElementById('main-grid'));
      set_max_height(document.getElementById('main-grid'));
      set_max_height(document.getElementById('current_mailbox_content'));
    }
    function select_letter(obj){
      $(".email-item").removeClass( "email-item-selected" );
      obj.className += " email-item-selected";
    };
    window.onload = align();
    window.addEventListener('resize', align);

  </script>
</html>